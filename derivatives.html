<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MTH229 with Julia - 6&nbsp; Approximate derivatives in Julia</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./first-second-derivatives.html" rel="next">
<link href="./limits.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Approximate derivatives in Julia</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MTH229 with Julia</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/MTH229/mth229.github.io/tree/master/quarto/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">MTH229 notes</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calculator.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Julia as a calculator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Functions in Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./graphing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Graphing functions with Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./zeros.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Solving for zeros with julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./limits.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Investigating limits with Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./derivatives.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Approximate derivatives in Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./first-second-derivatives.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Exploring first and second derivatives with Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./newton.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Newton’s method using julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extrema.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Maximization and minimization with Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./integration.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Numeric integration with Julia</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">MTH232 and 233</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mth232.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Notes on MTH 232 and Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mth233.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Notes on MTH 233 and Julia</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">6.1</span>  Introduction</a></li>
  <li><a href="#forward-difference-quotients-slope-of-the-tangent-line" id="toc-forward-difference-quotients-slope-of-the-tangent-line" class="nav-link" data-scroll-target="#forward-difference-quotients-slope-of-the-tangent-line"><span class="toc-section-number">6.2</span>  Forward difference quotients, Slope of the tangent line</a>
  <ul class="collapse">
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="toc-section-number">6.2.1</span>  Practice</a></li>
  </ul></li>
  <li><a href="#derivative-of-a-function" id="toc-derivative-of-a-function" class="nav-link" data-scroll-target="#derivative-of-a-function"><span class="toc-section-number">6.3</span>  Derivative of a function</a>
  <ul class="collapse">
  <li><a href="#practice-1" id="toc-practice-1" class="nav-link" data-scroll-target="#practice-1"><span class="toc-section-number">6.3.1</span>  Practice</a></li>
  </ul></li>
  <li><a href="#improvements-to-the-basic-forward-difference-quotient" id="toc-improvements-to-the-basic-forward-difference-quotient" class="nav-link" data-scroll-target="#improvements-to-the-basic-forward-difference-quotient"><span class="toc-section-number">6.4</span>  Improvements to the basic forward difference quotient</a>
  <ul class="collapse">
  <li><a href="#central-difference-quotient" id="toc-central-difference-quotient" class="nav-link" data-scroll-target="#central-difference-quotient"><span class="toc-section-number">6.4.1</span>  Central difference quotient</a></li>
  <li><a href="#practice-2" id="toc-practice-2" class="nav-link" data-scroll-target="#practice-2"><span class="toc-section-number">6.4.2</span>  Practice</a></li>
  </ul></li>
  <li><a href="#automatic-differentiation" id="toc-automatic-differentiation" class="nav-link" data-scroll-target="#automatic-differentiation"><span class="toc-section-number">6.5</span>  Automatic differentiation</a>
  <ul class="collapse">
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="toc-section-number">6.5.1</span>  Examples</a></li>
  <li><a href="#practice-3" id="toc-practice-3" class="nav-link" data-scroll-target="#practice-3"><span class="toc-section-number">6.5.2</span>  Practice</a></li>
  </ul></li>
  <li><a href="#error-analysis" id="toc-error-analysis" class="nav-link" data-scroll-target="#error-analysis"><span class="toc-section-number">6.6</span>  Error analysis</a>
  <ul class="collapse">
  <li><a href="#approximation-errors-for-the-central-difference-quotient" id="toc-approximation-errors-for-the-central-difference-quotient" class="nav-link" data-scroll-target="#approximation-errors-for-the-central-difference-quotient"><span class="toc-section-number">6.6.1</span>  Approximation errors for the central difference quotient</a></li>
  <li><a href="#practice-4" id="toc-practice-4" class="nav-link" data-scroll-target="#practice-4"><span class="toc-section-number">6.6.2</span>  Practice</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/MTH229/mth229.github.io/edit/master/quarto/derivatives.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/MTH229/mth229.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Approximate derivatives in Julia</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<pre class="{julia}"><code>#| echo: false

import Logging
Logging.disable_logging(Logging.Info) # or e.g. Logging.Info
Logging.disable_logging(Logging.Warn)

import SymPy
function Base.show(io::IO, ::MIME"text/html", x::T) where {T &lt;: SymPy.SymbolicObject}
    println(io, "&lt;span class=\"math-left-align\" style=\"padding-left: 4px; width:0; float:left;\"&gt; ")
    println(io, "\\[")
    println(io, sympy.latex(x))
    println(io, "\\]")
    println(io, "&lt;/span&gt;")
end


nothing</code></pre>
<p><br> A notebook for this material: <a href="https://raw.githubusercontent.com/mth229/229-projects/master/06-derivatives.ipynb">ipynb</a> <a href="./229-projects/06-derivatives.html">(Pluto html)</a> <a href="./229-projects/06-derivatives-pluto-commentary.html">(With commentary)</a></p>
<pre class="{julia}"><code>#| echo: false
using QuizQuestions
using LaTeXStrings</code></pre>
<section id="introduction" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">6.1</span> Introduction</h2>
<p>We load our packages to begin.</p>
<pre class="{julia}"><code>using MTH229
using Plots</code></pre>
<p>Single-variable calculus has two main concepts: the derivative and the integral, both defined in terms of a third important concept: the limit. The derivative is what we discuss here. The derivative allows us to talk about a tangent line to a curve. This is often called a line that touches the curve at just one point, but that isn’t quite correct, though often the case locally. A better idea would be to say it is the line that best approximates the curve at that point. That is, if we were to zoom in to the graph it might appear to look straight, and that straightness would have a slope that would match the tangent line. This idea leads to a primary use of the derivative – to approximate functions with simpler lines. Of course, this intuition is informal, a definition is in terms of the slope of approximating secant lines.</p>
<p>Historically, Fermat, in a treatise on finding maxima and minima, approached the problem of finding the tangent line by comparing the value of <span class="math inline">\(f(x)\)</span> to a nearby value <span class="math inline">\(f(x+h)\)</span>. Working with polynomials, meant that subtracting <span class="math inline">\(f(x+h) - f(x)\)</span> led to a polynomial in <span class="math inline">\(h\)</span>. Dividing by <span class="math inline">\(h\)</span> and then setting <span class="math inline">\(h=0\)</span> yields an answer for the slope.</p>
<p>The more modern approach (well Cauchy in the 1820s) defines the derivative of a function, <span class="math inline">\(f\)</span>, at a point <span class="math inline">\(c\)</span> as the slope of the <em>tangent line</em>, defined in terms of the <em>limit</em> of the slopes of approximating secant lines. The notation is:</p>
<p><span class="math display">\[
f'( c ) = \lim_{h \rightarrow 0} \frac{f(c + h) - f( c)}{h}.\quad\text{Derivative at a point}
\]</span></p>
<p>As mentioned, intuitively, the tangent line is the best straight-line approximation to a function near the point <span class="math inline">\((c, f( c))\)</span> and would have slope given by the derivative.</p>
<p>This graph shows <span class="math inline">\(f(x) = 2 - x^2\)</span> and various secant lines when <span class="math inline">\(c=-0.75\)</span>.</p>
<pre class="{julia}"><code>f(x) = 2 - x^2
c = -0.75
sec_line(h) = secant(f, c, c+h)                # secant in MTH229 package
plot(f, -1, 1, legend=false)
plot!(sec_line(1))
plot!(sec_line(0.75))
plot!(sec_line(0.5))
plot!(sec_line(0.25))</code></pre>
<p>As the value of <span class="math inline">\(h\)</span> goes towards 0 along the path <span class="math inline">\(1\)</span>, <span class="math inline">\(0.75\)</span>, <span class="math inline">\(0.5\)</span>, <span class="math inline">\(0.25\)</span>, … the slope of the secant line heads towards the slope of the tangent line, in this case <span class="math inline">\(2\cdot 0.75 = 1.5\)</span>.</p>
<p>Using the idea of a derivative at a point, one defines the derivative of the function <span class="math inline">\(f\)</span> to be the function which for each <span class="math inline">\(x\)</span> returns the derivative of <span class="math inline">\(f\)</span> at the point <span class="math inline">\(x\)</span>. Notationally, this just replaces <span class="math inline">\(c\)</span> above with <span class="math inline">\(x\)</span>, but conceptually there is a bit more to it.</p>
</section>
<section id="forward-difference-quotients-slope-of-the-tangent-line" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="forward-difference-quotients-slope-of-the-tangent-line"><span class="header-section-number">6.2</span> Forward difference quotients, Slope of the tangent line</h2>
<p>The rules of derivatives allow for a mechanical approach to taking derivatives with the power rule, chain rule and some special cases. In this project we look at approaching the derivative numerically. We start by investigating <em>approximate derivatives</em> computed with <em>finite difference quotients</em>.</p>
<p>The most naive approximation is simply to assume <span class="math inline">\(h\)</span> is some small number and use that to approximate the limit above:</p>
<pre class="{julia}"><code>f(x) = x^2 - 2x; fp(x) = 2x - 2
h = .001
c = 3
( f(c + h) - f(c) ) / h</code></pre>
<p>This is known as the <em>forward difference quotient</em> approximation to the derivative. For this example, the difference between the approximation and the actual slope is:</p>
<pre class="{julia}"><code>( f(c + h) - f(c) ) / h - fp(c)</code></pre>
<p>That is not too close, just to 3 digits of accuracy.</p>
<p>Notationally, we may write this as:</p>
<p><span class="math display">\[
f'( c) \approx \frac{f(c + h) - f( c) }{h}
\]</span></p>
<p>For some small value of <span class="math inline">\(h\)</span>. The equals sign is replaced by an approximation symbol, as there is no limit expression written.</p>
<section id="example-derivative-at-a-point" class="level5">
<h5 class="anchored" data-anchor-id="example-derivative-at-a-point">Example Derivative at a point</h5>
<p>Let’s try the derivative of some well known function. We know the derivative of <span class="math inline">\(f(x) = \sin(x)\)</span> is <span class="math inline">\(f'(x) = \cos(x)\)</span>. Let’s see if the above works well:</p>
<pre class="{julia}"><code>f(x) = sin(x); fp(x) = cos(x)
c = pi/4; h = 0.0001
( f(c + h) - f(c) )/h - fp(c)</code></pre>
<p>Not as good as we can get – the error is like <code>1e-5</code>, but not too bad already.</p>
</section>
<section id="example-finding-profit" class="level5">
<h5 class="anchored" data-anchor-id="example-finding-profit">Example Finding profit</h5>
<p>Suppose the tractor company John Deere models its profit per units sold through the function <span class="math inline">\(P(x) = 50 e^{x/250}/(1 - e^{x/250})\)</span>. Find the marginal profit for <span class="math inline">\(x=200\)</span>.</p>
<p>The marginal profit is the change in profit per unit sold – or the derivative – at <span class="math inline">\(x=200\)</span>. We can find this quite simply by either differentiating directly, or as we do here, approximating the answer with <code>julia</code>. We first note that the function above, is a composition, so it may be written using two functions:</p>
<pre class="{julia}"><code>f1(x) = exp(x)/(1 - exp(x))
f(x) = 50 * f1(x/250)
c = 200; h = 0.0001;
res = (f(c+h) - f(c))/h</code></pre>
<p>If <span class="math inline">\(50\)</span> is the maximum profit, this is a percentage increase of:</p>
<pre class="{julia}"><code>(res/50) * 100</code></pre>
<p>or a bit more than half a percent.</p>
</section>
<section id="example-finding-the-tangent-line-at-a-point" class="level5">
<h5 class="anchored" data-anchor-id="example-finding-the-tangent-line-at-a-point">Example Finding the tangent line at a point</h5>
<p>Let <span class="math inline">\(f(x) = x^x\)</span>. Find the tangent line at <span class="math inline">\(c=2\)</span>. Compare the difference between the value of the tangent line and the function at <span class="math inline">\(x=2.1\)</span>.</p>
<p>The tangent line is most easily expressed in terms of the <em>point-slope</em> formula for a line where the point is <span class="math inline">\((c, f( c))\)</span> and the slope is <span class="math inline">\(f'( c)\)</span>. This gives:</p>
<p><span class="math display">\[
y = f( c) + f'( c)\cdot(x - c)
\]</span></p>
<p>In the following, the slope of the tangent line will be <em>approximated</em> using a numeric derivative. We use <span class="math inline">\(h=0.0001\)</span>:</p>
<pre class="{julia}"><code>f(x) = x^x
c = 2; h = 0.0001
m = ( f(c + h) - f(c) ) / h
tangent_line(x) = f(c) + m * (x - c)</code></pre>
<p>To compare the difference, we have:</p>
<pre class="{julia}"><code>f(2.1) - tangent_line(2.1)</code></pre>
<p>A graph shows this difference:</p>
<pre class="{julia}"><code>plot([f, tangent_line], 1.85, 2.15)</code></pre>
</section>
<section id="practice" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="practice"><span class="header-section-number">6.2.1</span> Practice</h3>
<section id="question" class="level4">
<h4 class="anchored" data-anchor-id="question">Question</h4>
<p>Find the slope of the tangent line of <span class="math inline">\(f(x) = x\log(x)\)</span> at the value <span class="math inline">\(x=1\)</span> using <span class="math inline">\(h=0.0001\)</span> and the forward difference quotient method:</p>
<pre class="{julia}"><code>#| echo: false
f(x) = x*log(x)
c, h = 1, 0.0001;
val = (f(c+h) - f(c))/h;
numericq(val, 1e-6)</code></pre>
</section>
<section id="question-1" class="level4">
<h4 class="anchored" data-anchor-id="question-1">Question</h4>
<p>Find the slope of the tangent line of <span class="math inline">\(f(x) = x-\log(x)\)</span> at the value <span class="math inline">\(x=1\)</span> using <span class="math inline">\(h=0.0001\)</span> and the forward difference quotient method:</p>
<pre class="{julia}"><code>#| echo: false
f(x) = x-log(x)
c, h = 1, 0.0001;
val = (f(c+h) - f(c))/h;
numericq(val, 1e-6)</code></pre>
</section>
<section id="question-2" class="level4">
<h4 class="anchored" data-anchor-id="question-2">Question</h4>
<p>The built-in <code>airyai</code> function, when called as <code>airyai(x)</code>, returns the so-called Airy function, a special function named after</p>
<p><a href="http://en.wikipedia.org/wiki/Airy_function">George Biddell Airy</a>.</p>
<p>Compute the derivative at <span class="math inline">\(c=-3\)</span> using <span class="math inline">\(h=0.0001\)</span>.</p>
<pre class="{julia}"><code>#| echo: false
f(x) = airyai(x)
c, h = -3, 0.0001;
val = (f(c+h) - f(c))/h;
numericq(val, 1e-6)</code></pre>
</section>
<section id="question-3" class="level4">
<h4 class="anchored" data-anchor-id="question-3">Question</h4>
<p>Let <span class="math inline">\(f(x) = \sin(x)\)</span>. The slope of the tangent line at <span class="math inline">\(c=\pi/4\)</span> is well known to have slope <span class="math inline">\(\sqrt{2}/2\)</span>.</p>
<p>Compute the forward difference quotient for <span class="math inline">\(f\)</span> at <span class="math inline">\(c\)</span> using <span class="math inline">\(h=0.01\)</span>. What is the order of the difference between the two values?</p>
<pre class="{julia}"><code>#| echo: false
choices=["3 parts in 100",
         "3 parts in 1000",
     "3 parts in 10,000",
     "3 parts in 100,000"]
answer = 2
radioq(choices, answer, hint="Look at `sqrt(2)/2` minus the computed value",keep_order=true)</code></pre>
</section>
<section id="question-4" class="level4">
<h4 class="anchored" data-anchor-id="question-4">Question</h4>
<p>For the function <span class="math inline">\(f(x) = x^3 - 5x\)</span> use a forward difference quotient with <span class="math inline">\(h=0.0001\)</span> to approximate the slope of the tangent line at <span class="math inline">\(c=1\)</span>. Use this value to create a tangent line at <code>(c, f( c))</code>. Plot both the function and the tangent. Estimate graphically where the tangent line crosses the <span class="math inline">\(x\)</span> axis. The value is near:</p>
<pre class="{julia}"><code>#| echo: false
choices = [-2, -1.5, -1, -0.5, 0, 1]
answer = 3
radioq(choices, answer, keep_order=true)</code></pre>
</section>
</section>
</section>
<section id="derivative-of-a-function" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="derivative-of-a-function"><span class="header-section-number">6.3</span> Derivative of a function</h2>
<p>We might be interested not in the derivative at a point, but in the derivative as a function. This is how we think of the derivative when we say if <span class="math inline">\(f(x) = \sin(x)\)</span>, the <span class="math inline">\(f'(x) = \cos(x)\)</span>. Mathematically, from this viewpoint, the derivative is referred to as an <em>operator</em>, as it takes a function and returns a function.</p>
<p>We can reproduce this behavior easily enough with <code>julia</code>, as functions are <em>first class objects</em>: they can be passed as arguments and returned as values.</p>
<p>First, let’s define a function to find the derivative at a point using the “forward difference quotient”:</p>
<pre class="{julia}"><code>forward_difference(f, x0, h) = (f(x0 + h) - f(x0))/h</code></pre>
<p>We need three arguments of course as we have three ingredients to worry about: the function, the point and the size of <span class="math inline">\(h\)</span>.</p>
<p>To make an operator that takes <span class="math inline">\(f\)</span> and returns a function (an anonymous function in this case) that computes our approximation to <span class="math inline">\(f'\)</span> we can do the following:</p>
<pre class="{julia}"><code>Df(f; h=1e-8) = x -&gt; forward_difference(f, x, h)</code></pre>
<p>We specified a default value of <span class="math inline">\(h\)</span> for convenience, but allow it to be varied if desired.</p>
<p>To see this work, we can find and plot the derivative of <span class="math inline">\(\sin(x)\)</span>:</p>
<pre class="{julia}"><code>f(x) = sin(x)
fp(x) = Df(f)(x)
plot(f, 0, 2pi)
plot!(fp)</code></pre>
<p>Well, we already knew that should just be <span class="math inline">\(\cos(x)\)</span>. The point is we can easily make the an approximate derivative function from <code>f</code> with the definition <code>fp(x) = Df(f)(x)</code>.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Parsing Df(f)(x)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Seeing the pair of parenthesis can lead to confusion, as it isn’t common math notation. Here parentheses are not used for grouping, but rather function application. There are two function applications and the associativity rules for function application are left to right, as with most – but not all – operations. So <code>Df(f)</code> is done first. This returns a function (the approximate derivative) which is then evaluated at <code>x</code>.</p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Defining <code>fp</code> or <code>fp(x)</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>We could also have just plotted <code>f</code> and <code>Df(f)</code> without naming <code>fp</code>. As well, could have written <code>fp = Df(f)</code>, but that creates <code>fp</code> as an <em>anonymous</em> function and we then couldn’t redefine it through <code>fp(x) = ...</code>, which would attempt to make it a <em>generic</em> function.</p>
</div>
</div>
<p>Let’s look at a different function, where we don’t know in our heads the answer.</p>
<pre class="{julia}"><code>f(x) = exp(x)/(1 + exp(x))
plot(f, 0, 5)
plot!(Df(f))</code></pre>
<p>If we look, we can see from the graph that <code>f</code> is increasing and <code>Df(f)</code> is positive – this is no coincidence, of course.</p>
<section id="example-critical-points" class="level5">
<h5 class="anchored" data-anchor-id="example-critical-points">Example: Critical points</h5>
<p>A function’s <em>critical points</em> are where its derivative is <span class="math inline">\(0\)</span> or undefined. We can examine these by graphing the function’s derivative. Let’s do so for the polynomial <span class="math inline">\(f(x) = x^3 - 5x + 4\)</span>:</p>
<pre class="{julia}"><code>f(x) = x^3 -5x + 4
fp(x) = Df(f)(x)
plot(fp, -5, 5)</code></pre>
<p>You can check the zeroes graphically, say by zooming in a bit and adding the line <span class="math inline">\(y=0\)</span>:</p>
<pre class="{julia}"><code>plot(fp, -2, 2)
plot!(zero)</code></pre>
<p>If you want, we can find the roots numerically. For example,</p>
<pre class="{julia}"><code>find_zeros(fp, -10, 10)</code></pre>
</section>
<section id="example-when-is-a-function-increasing" class="level5">
<h5 class="anchored" data-anchor-id="example-when-is-a-function-increasing">Example: When is a function increasing?</h5>
<p>Let <span class="math inline">\(f(x) = \cos(x)\)</span> over the interval <span class="math inline">\([0, 360]\)</span> (in degrees). When is the function increasing?</p>
<p>From the relationship of the derivative and the function, we know the answer is when <span class="math inline">\(f'(x) &gt; 0\)</span>. For this example, we can solve this directly as <span class="math inline">\(f'(x) = -\sin(x)\)</span> and we know when that is positive (well you are supposed to anyways: when the angle is in the third and fourth quadrants). Let’s see how we would do this task with <code>julia</code> and compare.</p>
<p>First, we only need the derivative, so we just ask:</p>
<pre class="{julia}"><code>f(x) = cosd(x)          # using degrees
fp(x) = Df(f)(x)                # use default h</code></pre>
<p>Then we wish to indicate on the graph where <code>fp(x) &gt; 0</code>. We can do this by defining a function that is <span class="math inline">\(0\)</span> when that is the case and <code>NaN</code> otherwise (so that those points are not plotted). We do so below using the <code>plotif</code> function from the <code>MTH229</code> package</p>
<pre class="{julia}"><code>plotif(f, fp, 0, 360)  # second color when fp &gt; 0</code></pre>
</section>
<section id="practice-1" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="practice-1"><span class="header-section-number">6.3.1</span> Practice</h3>
<section id="question-5" class="level4">
<h4 class="anchored" data-anchor-id="question-5">Question</h4>
<p>Let <span class="math inline">\(f(x) = e^x\)</span>. Using a forward difference quotient and <span class="math inline">\(h=0.001\)</span> graph both the function and its approximate derivative over the interval <span class="math inline">\([0, 3]\)</span>. Estimate graphically the largest difference between the function and its approximate derivative.</p>
<pre class="{julia}"><code>#| echo: false
choices = ["It is about 0.1", "It is about 0.01", "It is about 0"]
fp(x, h=0.001) = (exp(x+h)-exp(x))/h
m = maximum(abs(exp(x) - fp(x)) for x ∈ range(0, 3, length=100))
_, answer = findmin(abs.(m .- (0.1, 0.01, 0)))
radioq(choices, answer)</code></pre>
</section>
<section id="question-6" class="level4">
<h4 class="anchored" data-anchor-id="question-6">Question</h4>
<p>Let <span class="math inline">\(f(x) = x^2 \exp(-x)\)</span>. Using <span class="math inline">\(h=0.0001\)</span> and an approximate derivative, estimate graphically where <span class="math inline">\(f'(x)\)</span> is positive on the interval <span class="math inline">\([0,3]\)</span>.</p>
<pre class="{julia}"><code>#| echo: false
choices = ["It is for the entire interval",
       "Between 0 and 2",
       "From 0 to about 0.45"]
answer = 2
radioq(choices, answer)</code></pre>
</section>
<section id="question-7" class="level4">
<h4 class="anchored" data-anchor-id="question-7">Question</h4>
<p>The critical points of a function are where its derivative is undefined or where its derivative is <span class="math inline">\(0\)</span>. For the function <span class="math inline">\(f(x) = 3x^4 -28x^3 + 96x^2 - 144x\)</span> graphically find any critical points over the interval <span class="math inline">\([0,10]\)</span></p>
<pre class="{julia}"><code>#| echo: false
choices=["There is one at 3",
     "There are two distinct ones: 2, 3",
     "There are two distinct ones: 2, 2.6667",
     "There are two distinct ones: 2, 4.69"]
answer = 2
radioq(choices, answer)</code></pre>
</section>
</section>
</section>
<section id="improvements-to-the-basic-forward-difference-quotient" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="improvements-to-the-basic-forward-difference-quotient"><span class="header-section-number">6.4</span> Improvements to the basic forward difference quotient</h2>
<p>The error in the approximation of the derivative depends on the size of <span class="math inline">\(h\)</span>. Mathematically, as <span class="math inline">\(h\)</span> gets smaller we get better approximations, though with the computer other complications arise. To see mathematically that this is the case, let’s look at the difference between the approximate numeric derivative from the forward difference quotient and a known derivative.</p>
<pre class="{julia}"><code>f(x) = sin(x)
fp(x) = cos(x)
[ Df(f,h=h)(.5) - fp(.5) for h=[.1, .01, .001, .0001, .00001] ]</code></pre>
<p>It gets better as <span class="math inline">\(h\)</span> gets smaller. In fact, it looks like when <span class="math inline">\(h\)</span> gets smaller by a factor of <span class="math inline">\(1/10\)</span> so does the error. Let’s look a little deeper though. Rather than type in the values of <span class="math inline">\(h\)</span> as above, let’s use an expression to compute them. Here we find the powers <span class="math inline">\(10^{-1}, \dots, 10^{-16}\)</span> at once and then compute the differences:</p>
<pre class="{julia}"><code>hs = [(1/10)^i for i in 1:16];
out = [ Df(f,h=h)(.5) - fp(.5) for h in hs ];
[hs out]</code></pre>
<p>When we look, we see that for awhile the approximation gets better (to about <code>1e-9</code>), but then does a U-turn and starts getting worse. The mathematical approximation gets better and better, but what happens is the computational error gets worse. We’ll see below how to pick the <span class="math inline">\(h\)</span> that best balances these off, but first lets look at how using different approximations for the derivative can improve the “mathematical” error.</p>
<section id="central-difference-quotient" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="central-difference-quotient"><span class="header-section-number">6.4.1</span> Central difference quotient</h3>
<p>It turns out that just by looking to the left and the right we can improve the mathematical error from getting better at a rate of <span class="math inline">\(h\)</span> to a rate of <span class="math inline">\(h^2\)</span>, provided our function is smooth enough and we don’t have issues on the boundaries. The formula, called the <em>central difference quotient</em> approximation to the derivative is:</p>
<p><span class="math display">\[
f'(x) \approx \frac{ f(x + h) - f(x - h) }{2h}
\]</span></p>
<p>For this the mathematical error is like <span class="math inline">\(h^2\)</span>, not <span class="math inline">\(h\)</span>.</p>
<p>Let’s compare. To make our life easier we again create some functions, as we did with <code>Df</code> above.</p>
<pre class="{julia}"><code>central_difference(f, x0, h) = (f(x0 + h) - f(x0 - h)) / (2h)
Dc(f; h=0.0001) = x -&gt; central_difference(f, x, h)</code></pre>
<p>Now to see whether a forward difference quotient or central difference quotient works better. We can do so with a table. Again with <span class="math inline">\(f(x) = \sin(x)\)</span></p>
<pre class="{julia}"><code>f(x) = sin(x)
fp(x) = cos(x)
using_D =  [ Df(f,h=h)(.5) - fp(.5) for h in hs ];
using_Dc = [ Dc(f,h=h)(.5) - fp(.5) for h in hs ];
[hs using_D using_Dc]</code></pre>
<p>The errors for the central difference quotient are either much smaller for the same size <span class="math inline">\(h\)</span> or the same. We see that we can use a larger <span class="math inline">\(h\)</span> to get the most accuracy in this example.</p>
<section id="example-when-does-the-tangent-line-hit-0" class="level5">
<h5 class="anchored" data-anchor-id="example-when-does-the-tangent-line-hit-0">Example: When does the tangent line hit 0?</h5>
<p>Let <span class="math inline">\(f(x) = 10/(1+x^2) - 10\exp(-(1/2)x^2)\)</span>. The tangent line at <span class="math inline">\(x=c\)</span> is given by</p>
<p><span class="math display">\[
y = f( c) - f'( c)(x - c)
\]</span></p>
<p>and this intersects the <span class="math inline">\(x\)</span> axis when <span class="math inline">\(y=0\)</span>. Solving this gives:</p>
<p><span class="math display">\[
c - f( c)/f'( c)
\]</span></p>
<p>Our goal is to compute this value for any <span class="math inline">\(c &gt; 0\)</span>.</p>
<p>Doing so is easy:</p>
<pre class="{julia}"><code>f(x) = 10/(1+x^2) - 10*exp(-(1/2)*x^2)
fp(x) = Dc(f)(x)
intersection_point(c) = c - f(c)/fp(c)</code></pre>
<p>For example, when <span class="math inline">\(c=1\)</span> we have:</p>
<pre class="{julia}"><code>c = 1;
intersection_point(c)</code></pre>
<p>You can tell from the graph of <span class="math inline">\(f(x)\)</span> that this value should be more than 1, as it is.</p>
<pre class="{julia}"><code>plot(f, .5, 2.1, legend=false)
plot!(zero)
plot!(x -&gt; f(c) + fp(c)*(x-c))</code></pre>
<hr>
<p>We could have defined <code>intersection_point</code> to accept a function with:</p>
<pre><code>intersection_point(f, c) = c  - f(c)/Dc(f)(c)</code></pre>
<p>Then it could easily be reused for other problems.</p>
</section>
</section>
<section id="practice-2" class="level3" data-number="6.4.2">
<h3 data-number="6.4.2" class="anchored" data-anchor-id="practice-2"><span class="header-section-number">6.4.2</span> Practice</h3>
<section id="question-8" class="level4">
<h4 class="anchored" data-anchor-id="question-8">Question</h4>
<p>Let</p>
<pre><code>f(x) = besselj(1, x)</code></pre>
<p>This defines <span class="math inline">\(f\)</span> as a Bessel function of the first kind with order <span class="math inline">\(\alpha=1\)</span>. Plot the approximate derivative over the interval <span class="math inline">\([0,5]\)</span>. There is one zero. What is its approximate value:</p>
<pre class="{julia}"><code>#| echo: false
using Roots
f(x) = besselj(1,x)
val = find_zero(Dc(f), [0,5])
numericq(val, 1e-1)</code></pre>
</section>
<section id="question-9" class="level4">
<h4 class="anchored" data-anchor-id="question-9">Question</h4>
<p>Let <span class="math inline">\(f(x) = \sin(\cos(x))\)</span>. Plot the approximate derivative of <span class="math inline">\(f\)</span>. How many zeros are there between <span class="math inline">\(5\)</span> and <span class="math inline">\(20\)</span>?</p>
<pre class="{julia}"><code>#| echo: false
answer=5
numericq(answer, 1e-10)</code></pre>
</section>
<section id="question-10" class="level4">
<h4 class="anchored" data-anchor-id="question-10">Question</h4>
<p>Let <span class="math inline">\(f(x) = |x^2 - 2|\)</span>. Plot the derivative of <span class="math inline">\(f(x)\)</span> over the interval <span class="math inline">\([-2,2]\)</span>. How many critical points do you see? (A critical point is where the derivative is <span class="math inline">\(0\)</span> <em>or</em> undefined.)</p>
<pre class="{julia}"><code>#| echo: false
answer = 3
numericq(answer, 1e-10)</code></pre>
</section>
</section>
</section>
<section id="automatic-differentiation" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="automatic-differentiation"><span class="header-section-number">6.5</span> Automatic differentiation</h2>
<p>We discuss now <a href="http://en.wikipedia.org/wiki/Automatic_differentiation">Forward Mode Automatic Differentiation</a>.</p>
<p>Automatic differentiation avoids the numeric instability issues of finite difference quotients by using a different approach. Whereas finite difference quotientss have a long history, automatic differentiation only dates back to the 50s.</p>
<p>The <code>ForwardDiff</code> package implements automatic differentiation.</p>
<p>The <code>MTH229</code> package overloads the idea of <code>'</code>, so uses automatic differentiation when the notation <code>f'</code> is encountered.</p>
<p>That means, we can find derivatives, as familiarly as:</p>
<pre class="{julia}"><code>f(x) = x^x
f'(1)</code></pre>
<p>Here <code>f</code> is a function, <code>f'</code> is a derived function, and <code>f'(1)</code> is this derived function evaluated at <code>1</code> – just as with the use within a math text book.</p>
<p>Unlike, finite difference quotients automatic differentiation does not have issues arising from the loss of precision encountered when subtracting two like-sized numbers. Unlike symbolic derivatives (such as those found by the Wolfram Alpha website used by your iPhone’s Siri) they can be computed quickly, even if the computations defining the function involve many steps.</p>
<p>So what is automatic differentiation? The idea of the forward mode is quite intuitive. The <em>tangent line</em> approximation of a function at the point <span class="math inline">\(c\)</span> becomes</p>
<p><span class="math display">\[
f(x) = f(c) + f'( c)(x-c) + O((x-c)^2)
\]</span></p>
<p>Where the notation <span class="math inline">\(O(x-c)^2\)</span> means that the last term is not precisely spelled out, but is like some constant times the difference <span class="math inline">\((x-c)^2\)</span>. This has many applications, but for this one it reduces the knowledge of the function values at this level to two values <span class="math inline">\((f(c), f'(c))\)</span></p>
<p>Now consider the product of two functions <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(g(x)\)</span>? The above formula applied to <span class="math inline">\(f \cdot g\)</span> is:</p>
<p><span class="math display">\[
(f\cdot g)(x) = f(c) \cdot g(c) + (f'( c)g( c) + f( c)g'( c))(x-c) + O((x-c)^2)
\]</span></p>
<p>This follows by the product rule. Again we have that two values determine the product <span class="math inline">\(f\cdot g\)</span> at this level, these being <span class="math inline">\((f(c) \cdot g(c)\)</span>, and <span class="math inline">\(f'( c)g( c) + f( c)g'( c)\)</span>. <em>But</em>, this combination can be made from the values <span class="math inline">\((f(c), f'(c))\)</span> and <span class="math inline">\((g(c), g'(c))\)</span> which represent <span class="math inline">\(f\)</span> and <span class="math inline">\(g\)</span>. Hence it is enough to know the two values for <span class="math inline">\(f\)</span> and <span class="math inline">\(g\)</span> to compute the two values for <span class="math inline">\(f\cdot g\)</span>.</p>
<p>In fact, the rules of derivatives allow us to say the same for addition, subtraction, multiplication, division, powers <em>and</em> composition. For composition this is from the chain rule:</p>
<p><span class="math display">\[
(f \circ g)(x) = (f \circ g)(c) + f'( g(c)) g'(c) (x-c) + O((x-c)^2).
\]</span></p>
<p>Automatic differentiation can be implemented by extending how we store a value, storing both <span class="math inline">\((x, dx)\)</span> as above. With this, the rules of differentials inform us how we combine these values. For example:</p>
<ul>
<li><span class="math display">\[
(x, dx) + (y, dy) = (x + y, d(x+y)) = (x + y, 1dx +  1dy)
\]</span></li>
<li><span class="math display">\[
(x, dx) \cdot (y, dy) = (xy, d(xy)) = (xy, y dx + x dy)
\]</span></li>
<li><span class="math display">\[
(x, dx)^n = (x^n, d(x^n)) = (x^n, n x^{n-1} dx)
\]</span></li>
</ul>
<p>etc.</p>
<p>For functions we need to use the chain rule:</p>
<ul>
<li><span class="math display">\[
f((x, dx)) = (f(x), d(f(x))) = (f(x), f'(x) dx )
\]</span></li>
</ul>
<section id="examples" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="examples"><span class="header-section-number">6.5.1</span> Examples</h3>
<p>Using <code>'</code>, we see that plotting a function and its derivative is straightforward:</p>
<pre class="{julia}"><code>f(x) = exp(-x)*sin(x)
plot(f, 0, 2pi)
plot!(f')</code></pre>
<p>Second derivatives are also available:</p>
<pre class="{julia}"><code>f(x) = x^2 - 2x
plot(f, -2, 2)
plot!(f')
plot!(f'')</code></pre>
<p>Here is an example where we plot the tangent line and the function. The <code>MTH229</code> package provides this function to compute a tangent line function:</p>
<pre class="{julia}"><code>#| eval: false
tangent(f, c) = x -&gt; f(c) + f'(c)*(x-c)</code></pre>
<p>This is employed as follows:</p>
<pre class="{julia}"><code>f(x) = x^x
c = 1
plot(f, 1/2, 2)
plot!(tangent(f, c))</code></pre>
<hr>
<section id="example-ap-calculus-question" class="level5">
<h5 class="anchored" data-anchor-id="example-ap-calculus-question">Example: AP Calculus question</h5>
<p>The 2014 AP Calculus exam included this question:</p>
<p>Grass clippings are placed in a bin, where they decompose. For <span class="math inline">\(0 \leq t \leq 30\)</span>, the amount of grass clippings remaining in the bin is modeled by <span class="math inline">\(A(t) = 6.687(0.931)^t\)</span>. Where <span class="math inline">\(A(t)\)</span> is measured in pounds and <span class="math inline">\(t\)</span> is measured in days.</p>
<ul>
<li>Find the average rate of change of <span class="math inline">\(A(t)\)</span> over the interval of <span class="math inline">\(0 \leq t \leq 30\)</span>. Indicate units of measure.</li>
<li>Find the value of <span class="math inline">\(A'(15)\)</span>. Using correct units, interpret the meaning of the value in the context of the problem.</li>
<li>Find the time <span class="math inline">\(t\)</span> for which the amount of grass clippings in the bin is equal to the average amount of grass clippings in the bin over the interval <span class="math inline">\(0 \leq t \leq 30\)</span>.</li>
<li>For <span class="math inline">\(t &gt; 30\)</span>, <span class="math inline">\(L(t)\)</span>, the linear approximation to <span class="math inline">\(A\)</span> at <span class="math inline">\(t=30\)</span> is a better model for the amount of grass clippings remaining in the bin. Use <span class="math inline">\(L(t)\)</span> to predict the time at which there will be 0.5% pound of grass clippings remaining in the bin. Show the work that leads to your answer.</li>
</ul>
<p>We can do all this relatively quickly with the <code>find_zero</code> function from the <code>Roots</code> package.</p>
<p>First, we define <span class="math inline">\(A(t)\)</span>:</p>
<pre class="{julia}"><code>A(t) = 6.687 * (0.931)^t</code></pre>
<p>The first question is answered by the slope of the secant line connecting <span class="math inline">\((0,A(0))\)</span> and <span class="math inline">\((30, A(30))\)</span>:</p>
<pre class="{julia}"><code>m = (A(30) - A(0)) / (30 - 0)</code></pre>
<p>The units are in pounds per day.</p>
<p>The second question is done through the derivative, as follows:</p>
<pre class="{julia}"><code>A'(15)</code></pre>
<p>This also has units in pounds per day. This is the instantaneous rate of decomposition, and is less (in absolute value) than the average decay rate.</p>
<p>The mean value theorem tells us that there is at least one time where the instantaneous decomposition rate equals the average rate over the interval <span class="math inline">\([0,30]\)</span>. Thus the endpoints form a bracketing interval for the equation <span class="math inline">\(A'(t) = m\)</span>, which we solve with:</p>
<pre class="{julia}"><code>find_zero(t -&gt; A'(t) - m, (0, 30))</code></pre>
<p>So at 12.4 days, the instantaneous rate is equal to the average rate of decomposition over the first 30 days.</p>
<p>But this doesn’t really answer the question asked, which is about the average amount of grass clippings in the bin. For this we need the integral form of the mean value theorem. Skipping ahead a few lessons to solve this problem, we have:</p>
<pre class="{julia}"><code>a, err = quadgk(A, 0, 30)   # area under A from 0,30
avg = a/(30-0)
find_zero(t -&gt; A(t) - avg, (0, 30))</code></pre>
<p>We get the same answer – think about whether that is a coincidence.</p>
<p>Finally, we can define <span class="math inline">\(L(t)\)</span> using the point-slope form of the line. The point is <span class="math inline">\((30, A(30))\)</span> and the slope is <span class="math inline">\(A'(30)\)</span>:</p>
<pre class="{julia}"><code>L(t) = A(30) + A'(30) * (t - 30) # t &gt; 30</code></pre>
<p>We could restrict <span class="math inline">\(L\)</span> to insist that <span class="math inline">\(t &gt; 30\)</span>, but this isn’t necessary. We are asked to solve this. Using <code>find_zero</code> requires a bracket. We check that <span class="math inline">\(L(30) &gt; 0.5\)</span> and that <span class="math inline">\(L(100)\)</span> is negative:</p>
<pre class="{julia}"><code>L(30), L(100)</code></pre>
<p>So, we can use <span class="math inline">\([30, 100]\)</span> as a bracket for <span class="math inline">\(L(t) - 0.5 = 0\)</span>:</p>
<pre class="{julia}"><code>find_zero(t -&gt; L(t) - 0.5, (30, 100))</code></pre>
<p>So a bit over 35 days to decompose to half a pound.</p>
<p>Here is a picture, showing the decay:</p>
<pre class="{julia}"><code>f(t) = t &lt;= 30 ? A(t) : L(t)
plot(f, 0, 40)</code></pre>
</section>
</section>
<section id="practice-3" class="level3" data-number="6.5.2">
<h3 data-number="6.5.2" class="anchored" data-anchor-id="practice-3"><span class="header-section-number">6.5.2</span> Practice</h3>
<section id="question-11" class="level4">
<h4 class="anchored" data-anchor-id="question-11">Question</h4>
<p>Which definition would be right for <span class="math inline">\((x,dx) - (y, dy)\)</span>?</p>
<pre class="{julia}"><code>#| echo: false
choices = [
"`(x - y, dx - y)`",
"`(x-y, dx - dy)`",
"`(x - dx, y -dy)`"
];
answer = 2;
radioq(choices, answer)</code></pre>
</section>
<section id="question-find-tangent-line-intersection" class="level4">
<h4 class="anchored" data-anchor-id="question-find-tangent-line-intersection">Question: find tangent line intersection</h4>
<p>Redefine <code>intersection_point</code> as:</p>
<pre class="{julia}"><code>intersection_point(f, c) = c - f(c)/f'(c)</code></pre>
<p>Now for <span class="math inline">\(f(x) = 10/(1+x^2) - 10 \cdot \exp(-(1/2) \cdot x^2)\)</span> and <span class="math inline">\(c=1\)</span> find the intersection point.</p>
<pre class="{julia}"><code>#| echo: false
val = 2;
numericq(val, 1e-4)</code></pre>
</section>
<section id="question-what-is-the-size-of-the-error" class="level4">
<h4 class="anchored" data-anchor-id="question-what-is-the-size-of-the-error">Question: what is the size of the error?</h4>
<p>We can compare the error at many different points with the following construct</p>
<pre class="{julia}"><code>#| eval: false
f(x) = exp(-x)*sin(x)
fp(x) = exp(-x)*(cos(x) - sin(x))
[abs(f'(x) - fp(x) ) for x in range(0, pi, 25)]</code></pre>
<p>What is the order (exponent) of the largest difference above?</p>
<pre class="{julia}"><code>#| echo: false
choices = [
"`1e-10`",
"`1e-14`",
"`1e-17`"
];
answer = 3;
radioq(choices, answer)</code></pre>
</section>
</section>
</section>
<section id="error-analysis" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="error-analysis"><span class="header-section-number">6.6</span> Error analysis</h2>
<p>We end with a digression on how big <code>h</code> should be to have the approximate derivatives as close as can be.</p>
<p>The choice of <span class="math inline">\(h\)</span> in the derivative approximations above was done somewhat arbitrarily, with only the intuition that smaller <span class="math inline">\(h\)</span>’s should produce more accurate approximations (which of course may be way off, as we are subtracting like-sized values in the derivative formula). Here we look a bit more closely at how to choose <span class="math inline">\(h\)</span>.</p>
<p>As mentioned, with a bit of work from the second semester of calculus one can learn that the <em>mathematical error</em> in the forward difference quotient is “order <span class="math inline">\(h\)</span>” whereas the mathematical error in the central difference quotient is “order <span class="math inline">\(h^2\)</span>. This means that as <span class="math inline">\(h\)</span> gets small the approximation error in the first is a multple of <span class="math inline">\(h\)</span>, but for the second a multiple of <span class="math inline">\(h^2\)</span> – a much smaller error in general.</p>
<p>However there is also error due to <em>floating point approximation</em>. Such error is different in that it gets bigger as <span class="math inline">\(h\)</span> gets smaller. So one error gets bigger, the other gets smaller. So clearly if <span class="math inline">\(h\)</span> gets too small, the floating point error will dominate and the overall error will not get smaller, rather larger.</p>
<p>So, how big is the floating point error? For any given number, it can be roughly as big as the the machine precision amount, <span class="math inline">\(\epsilon\)</span>. So in the forward-difference quotient approximation we could have errors in both terms <span class="math inline">\(f(x+h)\)</span> and <span class="math inline">\(f(x)\)</span> so the total error could be as big as <span class="math inline">\(2\epsilon\)</span>. But this is divided by <span class="math inline">\(h\)</span> as we have:</p>
<p><span class="math display">\[
\frac{f(x+h) - f(x)}{h} = \frac{float(f(x +h)) + \epsilon - float(f(x_) + \epsilon}{h} =
         \frac{float(f(x+h))-float(f(x))}{h} + \frac{2\epsilon}{h}.
\]</span></p>
<p>The errors may or <em>may not</em> cancel so the algebra with <span class="math inline">\(\epsilon\)</span> is unusual to the untrained eye. It basically takes into account the worse case.</p>
<p>The key is the <span class="math inline">\(2\epsilon/h\)</span> term – it gets bigger as <span class="math inline">\(h\)</span> gets smaller.</p>
<p>So if each floating point approximation is no more off than <span class="math inline">\(\epsilon\)</span>, we have this bound on the error:</p>
<p><span class="math display">\[
\text{error} \leq \frac{2\epsilon}{h} + (M/2)h
\]</span></p>
<p>Where <span class="math inline">\(M\)</span> is a constant that depends on the maximum absolute value of the second derivative and the <span class="math inline">\(1/2\)</span> comes from second semester calculus. Choosing <span class="math inline">\(h\)</span> to make this as small as possible is possible with some calculus involving the derivative, but for now we simply note the answer is <span class="math inline">\(h=((2\epsilon)/(M/2))^{1/2}\)</span>.</p>
<p>Taking <span class="math inline">\(\epsilon\)</span> as machine tolerance and (conveniently) <span class="math inline">\(M=1\)</span> we get</p>
<p><span class="math display">\[
h_{min} = \sqrt((2\epsilon)/(1/2)) \approx 10^{-8}
\]</span></p>
<p>Or more precisely:</p>
<pre class="{julia}"><code>sqrt( (2*eps())/(1/2) )</code></pre>
<p>We can check this is about right,but graphing on a different scale:</p>
<pre class="{julia}"><code>f(h; M=1) = 2*eps()/h + (M/2)*h
g(x) = log10(f(10.0^(-x)))
plot(g, 1, 10)          # min near 8, which means h like 1e-8</code></pre>
<p>Numerically, we can check how this basically works for some test function:</p>
<pre class="{julia}"><code>f(x) = exp(x) - x^3
fp(x) = exp(x) - 3x^2
[hs [Df(f,h=h)(.5) - fp(.5) for h in hs] ]</code></pre>
<p>We see the best case is around <span class="math inline">\(h=10^{-8}\)</span>, as expected by the theory.</p>
<section id="approximation-errors-for-the-central-difference-quotient" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="approximation-errors-for-the-central-difference-quotient"><span class="header-section-number">6.6.1</span> Approximation errors for the central difference quotient</h3>
<p>For the central difference quotient, the errors are different. The error in <span class="math inline">\(h\)</span> becomes:</p>
<p><span class="math display">\[
\text{error} \leq (2\epsilon)/(2h) + (M/6) h^2
\]</span></p>
<p>This gives <span class="math inline">\((3\epsilon/M)^{1/3}\)</span> as the choice for <span class="math inline">\(h\)</span> that minimizes the right-hand expression.</p>
<p>Taking <span class="math inline">\(\epsilon\)</span> as the machine tolerance and (conveniently) <span class="math inline">\(M=3\)</span> we get</p>
<p><span class="math display">\[
h_{min} \approx 10^{-6}
\]</span></p>
<p>We can again check how this works for our function and point:</p>
<pre class="{julia}"><code>[hs [ Dc(f,h=h)(.5) - fp(.5) for h in hs] ]</code></pre>
</section>
<section id="practice-4" class="level3" data-number="6.6.2">
<h3 data-number="6.6.2" class="anchored" data-anchor-id="practice-4"><span class="header-section-number">6.6.2</span> Practice</h3>
<section id="question-best-depends-on-the-function-and-value" class="level4">
<h4 class="anchored" data-anchor-id="question-best-depends-on-the-function-and-value">Question: best depends on the function and value</h4>
<p>A subtle point above is that we are minimizing an upper bound in <span class="math inline">\(h\)</span> with an assumption, not the actual error. The actual answer may differ as it depends on a function and the point of evaluation. Look at the function <span class="math inline">\(f(x) = x^2 - 2x\)</span> and compare the values at <span class="math inline">\(0.5\)</span> as above:</p>
<pre class="{julia}"><code>hs = [(1/10)^i for i in 1:16]
f(x) = x^2 - 2x
fp(x) = 2x - 2
[hs [Dc(f,h=h)(.5) - fp(.5) for h in hs] ]</code></pre>
<p>What is the best value of <span class="math inline">\(h\)</span>?</p>
<p>For which of these values of <span class="math inline">\(h\)</span> is the error smallest?</p>
<pre class="{julia}"><code>#| echo: false
choices = [
"`1e-3`",
"`1e-6`",
"`1e-8`",
"`1e-12`"
];
answer = 1;
radioq(choices, answer, keep_order=true)</code></pre>
</section>
<section id="question-error-analysis" class="level4">
<h4 class="anchored" data-anchor-id="question-error-analysis">Question: error analysis</h4>
<p>Consider these commands:</p>
<pre class="{julia}"><code>#| eval: false
f(x) = sin(x)
fp(x) = cos(x)
[hs [ Dc(f,h=h)(.5) - fp(.5) for h in hs] ]</code></pre>
<p>Do they show the smallest error around <span class="math inline">\(10^{-6}\)</span> as expected?</p>
<pre class="{julia}"><code>#| echo: false
booleanq(true)</code></pre>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./limits.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Investigating limits with Julia</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./first-second-derivatives.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Exploring first and second derivatives with Julia</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>