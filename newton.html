<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MTH229 with Julia - 8&nbsp; Newton’s method using julia</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./extrema.html" rel="next">
<link href="./first-second-derivatives.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Newton’s method using julia</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MTH229 with Julia</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/MTH229/mth229.github.io/tree/master/quarto/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">MTH229 notes</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calculator.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Julia as a calculator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Functions in Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./graphing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Graphing functions with Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./zeros.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Solving for zeros with julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./limits.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Investigating limits with Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./derivatives.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Approximate derivatives in Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./first-second-derivatives.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Exploring first and second derivatives with Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./newton.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Newton’s method using julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extrema.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Maximization and minimization with Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./integration.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Numeric integration with Julia</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">MTH232 and 233</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mth232.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Notes on MTH 232 and Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mth233.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Notes on MTH 233 and Julia</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">8.1</span>  Introduction</a></li>
  <li><a href="#basic-idea" id="toc-basic-idea" class="nav-link" data-scroll-target="#basic-idea"><span class="toc-section-number">8.2</span>  Basic idea</a>
  <ul class="collapse">
  <li><a href="#repeating-steps" id="toc-repeating-steps" class="nav-link" data-scroll-target="#repeating-steps"><span class="toc-section-number">8.2.1</span>  Repeating steps</a></li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="toc-section-number">8.2.2</span>  Practice</a></li>
  </ul></li>
  <li><a href="#implementing-a-newtons-method-function" id="toc-implementing-a-newtons-method-function" class="nav-link" data-scroll-target="#implementing-a-newtons-method-function"><span class="toc-section-number">8.3</span>  Implementing a Newton’s method function</a>
  <ul class="collapse">
  <li><a href="#practice-1" id="toc-practice-1" class="nav-link" data-scroll-target="#practice-1"><span class="toc-section-number">8.3.1</span>  Practice</a></li>
  </ul></li>
  <li><a href="#numeric-derivatives" id="toc-numeric-derivatives" class="nav-link" data-scroll-target="#numeric-derivatives"><span class="toc-section-number">8.4</span>  Numeric derivatives</a>
  <ul class="collapse">
  <li><a href="#the-secant-method" id="toc-the-secant-method" class="nav-link" data-scroll-target="#the-secant-method"><span class="toc-section-number">8.4.1</span>  The secant method</a></li>
  <li><a href="#using-forward-differences" id="toc-using-forward-differences" class="nav-link" data-scroll-target="#using-forward-differences"><span class="toc-section-number">8.4.2</span>  Using forward differences</a></li>
  <li><a href="#problems" id="toc-problems" class="nav-link" data-scroll-target="#problems"><span class="toc-section-number">8.4.3</span>  Problems</a></li>
  </ul></li>
  <li><a href="#the-find_zero-function" id="toc-the-find_zero-function" class="nav-link" data-scroll-target="#the-find_zero-function"><span class="toc-section-number">8.5</span>  The <code>find_zero</code> function</a>
  <ul class="collapse">
  <li><a href="#using-find_zero-and-a-graph-to-find-all-roots." id="toc-using-find_zero-and-a-graph-to-find-all-roots." class="nav-link" data-scroll-target="#using-find_zero-and-a-graph-to-find-all-roots."><span class="toc-section-number">8.5.1</span>  Using <code>find_zero</code> and a graph to find all roots.</a></li>
  <li><a href="#practice-2" id="toc-practice-2" class="nav-link" data-scroll-target="#practice-2"><span class="toc-section-number">8.5.2</span>  Practice</a></li>
  </ul></li>
  <li><a href="#various-issues-with-newtons-method" id="toc-various-issues-with-newtons-method" class="nav-link" data-scroll-target="#various-issues-with-newtons-method"><span class="toc-section-number">8.6</span>  Various issues with Newton’s method</a>
  <ul class="collapse">
  <li><a href="#the-initial-guess-is-no-where-near-the-end-results" id="toc-the-initial-guess-is-no-where-near-the-end-results" class="nav-link" data-scroll-target="#the-initial-guess-is-no-where-near-the-end-results"><span class="toc-section-number">8.6.1</span>  The initial guess is no where near the end results</a></li>
  <li><a href="#function-has-a-poor-shape" id="toc-function-has-a-poor-shape" class="nav-link" data-scroll-target="#function-has-a-poor-shape"><span class="toc-section-number">8.6.2</span>  Function has a poor shape</a></li>
  <li><a href="#cycles" id="toc-cycles" class="nav-link" data-scroll-target="#cycles"><span class="toc-section-number">8.6.3</span>  Cycles</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/MTH229/mth229.github.io/edit/master/quarto/newton.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/MTH229/mth229.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Newton’s method using julia</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<pre class="{julia}"><code>#| echo: false

import Logging
Logging.disable_logging(Logging.Info) # or e.g. Logging.Info
Logging.disable_logging(Logging.Warn)

import SymPy
function Base.show(io::IO, ::MIME"text/html", x::T) where {T &lt;: SymPy.SymbolicObject}
    println(io, "&lt;span class=\"math-left-align\" style=\"padding-left: 4px; width:0; float:left;\"&gt; ")
    println(io, "\\[")
    println(io, sympy.latex(x))
    println(io, "\\]")
    println(io, "&lt;/span&gt;")
end


nothing</code></pre>
<p><br> A notebook for this material: <a href="https://raw.githubusercontent.com/mth229/229-projects/master/09-extrema.ipynb">ipynb</a> <a href="./229-projects/09-extrema.html">(Pluto html)</a> <a href="./229-projects/09-extrema-pluto-commentary.html">(With commentary)</a></p>
<section id="introduction" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">8.1</span> Introduction</h2>
<p>Newton’s method is an old method for <em>approximating</em> a zero of a function, <span class="math inline">\(f(x)\)</span>:</p>
<p><span class="math display">\[
f(x) = 0
\]</span></p>
<p>Previously we discussed the <em>bisection method</em> which applied for some continuous function <span class="math inline">\(f(x)\)</span> which changed signs between <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, points which bracket a zero. Not only did we need to find these bracketing points – which wasn’t hard from a graph, more importantly the actual algorithm is pretty slow.</p>
<p>If the function <span class="math inline">\(f\)</span> is sufficiently differentiable, then Newton’s method may work to find a zero. Unlike the bisection method which is slow but guaranteed to find a root by the intermediate value theorem, Newton’s method is fast (once it is close) but has no such guarantee of converging. In this project, we’ll see how to implement the algorithm, try some examples, and then look at what can go wrong.</p>
<p>The <code>MTH229</code> package provides a function <code>newton</code> for easily performing Newton’s method, utilizing a function from the <code>Roots</code> package. More usefully, we will see that <code>find_zero</code>, which we used for bisection, can also be used for root finding with an algorithm that is a bit more robust than Newton’s method.</p>
<p>To begin, we load <code>MTH229</code> and <code>Plots</code>. In the background this loads <code>Roots</code>:</p>
<pre class="{julia}"><code>using MTH229
using Plots</code></pre>
<pre class="{julia}"><code>#| echo: false
using QuizQuestions
using LaTeXStrings</code></pre>
</section>
<section id="basic-idea" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="basic-idea"><span class="header-section-number">8.2</span> Basic idea</h2>
<p>The idea behind Newton’s method is simple – <em>linear approximation</em>. That is, most functions at any given point are well approximated by the tangent line at that point. If we have a good guess <span class="math inline">\(x_n\)</span>, then we can improve this guess iteratively by replacing it with the zero, <span class="math inline">\(x_{n+1}\)</span>, of the tangent line at <span class="math inline">\((x_n, f(x_n))\)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/newton/newton-one-step.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Newton, one step</figcaption><p></p>
</figure>
</div>
<p>A simple picture shows that we have a triangle with base <span class="math inline">\(x_{n+1} - x_{n}\)</span>, rise <span class="math inline">\(0 - f(x_n)\)</span> and slope <span class="math inline">\(f'(x_n)\)</span>, using the “rise over run” formula:</p>
<p><span class="math display">\[
f'(x_n) = \frac{-f(x_n)}{x_{n+1} - x_{n}}.
\]</span></p>
<p>The basic algorithm of Newton’s methods solves this to get:</p>
<p><span class="math display">\[
x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)}.
\]</span></p>
<p>Some books write the right-hand side as <span class="math inline">\(x_n - f'(x_n)^{-1} f(x_n)\)</span>, a form that generalizes to different settings.</p>
<p>Like the bisection method, Newton’s method is an <em>iterative method</em>. One begins with a (suitable) guess <span class="math inline">\(x_0\)</span>. From that the algorithm produces <span class="math inline">\(x_1\)</span> which is used to produce <span class="math inline">\(x_2\)</span>, etc. The idea is that one eventually will settle on a value <span class="math inline">\(x_n\)</span> sufficiently close to the desired root.</p>
<p>Mathematically, the indices indicate that the right hand side is computed and assigned to the left hand side. This is exactly what is done in assignment within <code>julia</code>, so the above simply becomes:</p>
<pre class="{julia}"><code>#| eval: false
x = x - f(x)/f'(x)</code></pre>
<p>Where <code>f(x)</code> is the function and <code>f'(x)</code> its derivative. (In this case found by automatic differentiation.) This line starts with a previously defined value of <code>x</code> and updates it accordingly.</p>
<p>The updating is continued – by executing the exact same command – until either the algorithm has gotten close enough to an answer (i.e., it has converged) or we have given up on it converging.</p>
<p>Here is an example to find a zero of the function: <span class="math inline">\(f(x) = x^3 - 2x - 5\)</span>.</p>
<p>A quick graph shows a root near 2:</p>
<pre class="{julia}"><code>f(x) = x^3 - 2x - 5
plot(f, -3, 3)</code></pre>
<p>Here we improve the estimate for the root near 2 using Newton’s method. We will need the first derivative, which we denote <code>fp</code></p>
<pre class="{julia}"><code>fp(x) = 3x^2 - 2
x = 2               # starting value, x_0
x = x - f(x)/fp(x)      # new value, x_1
x, f(x)</code></pre>
<p>We can visualize our progress as follows, noting that <code>x</code> holds <span class="math inline">\(x_1\)</span>, and zooming into the domain <span class="math inline">\([1,3]\)</span>:</p>
<pre class="{julia}"><code>x0, x1 = 2, x
plot(f, 1, 3, legend=false)
plot!([x0, x0, x1], [0, f(x0), 0])  # why these values?
scatter!([x0, x1], [0, 0])</code></pre>
<p>Continuing, though without visualizing the progress, this next step will compute <span class="math inline">\(x_2\)</span>:</p>
<pre class="{julia}"><code>x = x - f(x)/fp(x)
x, f(x)</code></pre>
<p>This next step will compute <span class="math inline">\(x_3\)</span>:</p>
<pre class="{julia}"><code>x = x - f(x)/fp(x)
x, f(x)</code></pre>
<p>This next step will compute <span class="math inline">\(x_4\)</span>:</p>
<pre class="{julia}"><code>x = x - f(x)/fp(x)
x, f(x)</code></pre>
<p>This next step will compute <span class="math inline">\(x_5\)</span>:</p>
<pre class="{julia}"><code>x = x - f(x)/fp(x)      # x stopped changing
x, f(x)</code></pre>
<p>We see that <span class="math inline">\(x_4=x_5\)</span>, so the algorithm has stabilized. We also see that <span class="math inline">\(f(x_4)\)</span> is basically <span class="math inline">\(0\)</span> (Recall, <code>eps()</code> is the machine precision, or the size of the difference between floating point values at <span class="math inline">\(1.0\)</span> is basically <span class="math inline">\(10^{-16}\)</span>, the size of <span class="math inline">\(f(x_4)\)</span>.)</p>
<p>You can see in this case that the convergence happens quickly as soon as the algorithm gets close.</p>
<p>The approximate root is <span class="math inline">\(x_4\)</span>. It is important to realize that the actual, <em>exact</em>, answer is not likely to be the value computed by Newton’s method, which we call <code>xstar</code> at times. In most cases, the true answer will be irrational and <code>xstar</code> a floating point number, which ultimately can never be better than an approximation to an irrational number.</p>
<p>The above example iterated until it was clear the algorithm does not improve itself, as the values returned did not change. This need not be the case for every problem.</p>
<p>Rather, we can determine two ways that the number is close enough to the answer:</p>
<ul>
<li>The sequence of <code>x</code>’s stop changing by much</li>
<li>the values <code>f(x)</code> get close enough to zero.</li>
</ul>
<p>In the above, the first one was used. In either case, rather than look for values to be equal (e.g.&nbsp;<span class="math inline">\(x_{n+1} = x_{n}\)</span> or <span class="math inline">\(f(x_n) = 0\)</span>, we look at whether these two things are close enough to be so. That means for some tolerance, we stop when the change in the <code>x</code>’s is smaller than the tolerance or <code>f(x)</code> is smaller – in absolute value – than the tolerance.</p>
<section id="repeating-steps" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="repeating-steps"><span class="header-section-number">8.2.1</span> Repeating steps</h3>
<p>The above approach – basically repeating steps – can be tedious. There will be a function to do this for you (<code>newton</code>). One can use copy and paste to do much of this though:</p>
<pre class="{julia}"><code>f(x) = x^3 - 2x - 5
x = 2
x = x - f(x)/f'(x)
x = x - f(x)/f'(x)
x = x - f(x)/f'(x)
x = x - f(x)/f'(x)
x = x - f(x)/f'(x)

(x, f(x))</code></pre>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Newton looked at this same example in 1699 (B.T. Polyak, <em>Newton’s method and its use in optimization</em>, European Journal of Operational Research. 02/2007; 181(3):1086-1096.) though his technique was slightly different as he did not use the derivative, <em>per se</em>, but rather an approximation based on the fact that his function was a polynomial (though identical to the derivative). Raphson (1690) proposed the general form, hence the usual name of Newton-Raphson method.</p>
</div>
</div>
<hr>
</section>
<section id="practice" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="practice"><span class="header-section-number">8.2.2</span> Practice</h3>
<section id="question" class="level4">
<h4 class="anchored" data-anchor-id="question">Question</h4>
<p>Using Newton’s method to find <span class="math inline">\(\sqrt{k}\)</span> (by solving for roots of <span class="math inline">\(f(x) = x^2 - k\)</span>) is also referred to as the Babylonian method, due to its origins. The resulting method</p>
<p><span class="math display">\[
x_{n+1} = \frac{1}{2}(x_n + \frac{k}{x_n})
\]</span></p>
<p>is described by the first-century <a href="http://en.wikipedia.org/wiki/Babylonian_method">Greek mathematician Hero of Alexandria</a>.</p>
<p>Let <span class="math inline">\(k=15\)</span> and <span class="math inline">\(x_0\)</span> be <span class="math inline">\(4\)</span>. What is the value of <span class="math inline">\(x_3\)</span>?</p>
<pre class="{julia}"><code>#| echo: false
x0 = 4
f(x) =  1/2*(x + 15/x)
val = f(f(f(x0)))
numericq(val, 1e-4)</code></pre>
</section>
<section id="question-1" class="level4">
<h4 class="anchored" data-anchor-id="question-1">Question</h4>
<p>The function <span class="math inline">\(f(x) = \sin(x)\)</span> has derivative <span class="math inline">\(f'(x) = \cos(x)\)</span>. Use Newton’s method to solve <span class="math inline">\(f(x) = 0\)</span> starting at <span class="math inline">\(3\)</span>. Repeat 5 times. What value do you get for <code>x</code>?</p>
<pre class="{julia}"><code>#| echo: false
f(x) = x - sin(x)/cos(x)
x0 = 3
val = f(f(f(f(x0))))
numericq(val, 1e-14)</code></pre>
<p>(This can be used to compute <span class="math inline">\(\pi\)</span> numerically, as the convergence is very fast. Here it takes 4 steps to verify.)</p>
</section>
<section id="question-2" class="level4">
<h4 class="anchored" data-anchor-id="question-2">Question</h4>
<p>Let <span class="math inline">\(f(x) = x^2 - 3^x\)</span>. This has derivative <span class="math inline">\(2x - 3^x \cdot \log(3)\)</span>. Starting with <span class="math inline">\(x_0=0\)</span>, what does Newton’s method converge on?</p>
<pre class="{julia}"><code>#| echo: false
using Roots
f(x) = x^2 - 3^x;
fp(x) = 2x - 3^x*log(3);
val = newton(f, fp, 0);
numericq(val, 1e-14)</code></pre>
</section>
</section>
</section>
<section id="implementing-a-newtons-method-function" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="implementing-a-newtons-method-function"><span class="header-section-number">8.3</span> Implementing a Newton’s method function</h2>
<p>For iterative algorithms it is better to repeat the expression until something happens – not a fixed number of times. In this case, we need a criteria to decide if the algorithm has converged. We shall use the following:</p>
<ul>
<li>If the value of <span class="math inline">\(|x_{n+1} - x_n| &lt; tol\)</span> the algorithm has converged</li>
<li>If the value of <span class="math inline">\(|f(x_n)| &lt; tol\)</span> the algorithm has converged</li>
<li>If the above hasn’t happened by <span class="math inline">\(n=100\)</span> the algorithm fails to converge</li>
</ul>
<p>This isn’t perfect, but will be sufficient. (Well, in fact no stopping rule can be perfect, but this one doesn’t account for the relative size of the <span class="math inline">\(x_n\)</span>s which can be important.)</p>
<p>The first two steps require a tolerance. We will use <code>1e-14</code> for this. This is about 100 times the machine precision, <code>eps()</code>, which is sufficient when the answers are moderate in size. This is not very good if the answers are very large.</p>
<p>A basic algorithm is to repeat a step of Newton’s method until the above occurs. We wrap this up in a function for reuse, and employ a <code>while</code> loop to repeat the update step until something happens:</p>
<pre class="{julia}"><code>function nm(f, fp, x)
     xnew, xold = x, Inf
     fn, fo = f(xnew), Inf

     tol = 1e-14
     ctr = 1

     while (ctr &lt; 100) &amp;&amp; (abs(xnew - xold) &gt; tol) &amp;&amp; ( abs(fn - fo) &gt; tol )
       x = xnew - f(xnew)/fp(xnew) # update step
       xnew, xold = x, xnew
           fn, fo = f(xnew), fn
       ctr = ctr + 1
     end

     if ctr == 100
        error("Did not converge in 100 steps")
         else
       xnew, ctr
         end
end
</code></pre>
<p>Here we use the <code>nm</code> function to find a zero of this polynomial:</p>
<pre class="{julia}"><code>f(x) = x^3 - 5x + 1
fp(x) = 3x^2 - 5
xstar, ctr = nm(f, fp, 0)   # takes 6 steps</code></pre>
<p>However, the <code>MTH229</code> package provides the <code>newton</code> function. So we shall use that in the sequel. To see the number of steps, the argument <code>verbose=true</code> may be given.</p>
<hr>
<p>We revisit a problem from a previous project, finding zeroes of the function <span class="math inline">\(f(x) = \exp(x) - x^4\)</span>. We know from previous work that there are three of them. Let’s find one near <span class="math inline">\(x=2\)</span>:</p>
<pre class="{julia}"><code>f(x) = exp(x) - x^4
x = 2
xstar = newton(f, 2)  # newton will use automatic differentiation for the derivative</code></pre>
<p>It took 8 steps and we are this close:</p>
<pre class="{julia}"><code>xstar, f(xstar)</code></pre>
<p>In this case, the answer is exact up to floating point round off.</p>
<section id="practice-1" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="practice-1"><span class="header-section-number">8.3.1</span> Practice</h3>
<section id="question-3" class="level4">
<h4 class="anchored" data-anchor-id="question-3">Question</h4>
<p>Repeat the problem of finding a root of <span class="math inline">\(f(x) = \exp(x) - x^4\)</span> starting at <span class="math inline">\(x=2\)</span>. (<code>newton(f, 2, verbose=true)</code>). How many iterations does it take with the default tolerances?</p>
<pre class="{julia}"><code>#| echo: false
numericq(6, 1e-1)</code></pre>
</section>
<section id="question-4" class="level4">
<h4 class="anchored" data-anchor-id="question-4">Question</h4>
<p>If we repeat with <span class="math inline">\(f(x) = \exp(x) - x^4\)</span> but start now at <span class="math inline">\(x=8\)</span> where does the algorithm converge?</p>
<pre class="{julia}"><code>#| echo: false
f(x) = exp(x) - x^4;
numericq(newton(f, 8), 1e-6)</code></pre>
</section>
<section id="question-5" class="level4">
<h4 class="anchored" data-anchor-id="question-5">Question</h4>
<p>Let <span class="math inline">\(f(x) = \sin(x) - \cos(4\cdot x)\)</span>.</p>
<p>Starting at <span class="math inline">\(\pi/8\)</span>, solve for the root returned by Newton’s method</p>
<pre class="{julia}"><code>#| echo: false
k1=4
f(x)  = sin(x) - cos(k1*x);
fp(x) = cos(x) + k1*sin(k1*x);
val = newton(f, fp, pi/(2k1));
numericq(val)</code></pre>
</section>
</section>
</section>
<section id="numeric-derivatives" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="numeric-derivatives"><span class="header-section-number">8.4</span> Numeric derivatives</h2>
<p>In order to use Newton’s method we need to evaluate <span class="math inline">\(f'(x)\)</span>. We have used automatic differentiation above through <code>f'(x)</code>. Automatic differentiation returns a numerically accurate value for the derivative.</p>
<p>However, Newton’s method is actually fairly robust to using other related values to the derivative. That is the method will converge, though perhaps not as fast as with the derivative.</p>
<section id="the-secant-method" class="level3" data-number="8.4.1">
<h3 data-number="8.4.1" class="anchored" data-anchor-id="the-secant-method"><span class="header-section-number">8.4.1</span> The secant method</h3>
<p>The <a href="http://en.wikipedia.org/wiki/Secant_method">secant method</a> is perhaps the oldest numerical linear algebra tool dating back over <a href="http://scholarship.rice.edu/bitstream/handle/1911/20568/1442093.PDF?sequence=1">3000 years</a> well before Newton’s method. Rather than use the derivative at <span class="math inline">\(x_i\)</span> to compute <span class="math inline">\(x_{i+1}\)</span>, the secant line is used between <span class="math inline">\(x_{i-1}\)</span> and <span class="math inline">\(x_i\)</span>. This method will also converge to a zero with a good starting point, though not nearly as quickly as Newton’s method.</p>
<p>You can check – if you want – by repeating the last command until the change in <code>x2</code> is within your tolerance:</p>
<pre class="{julia}"><code>x2, x1 = 1, 2           # initial guess of 2
f(x) = x^2 - 2          # some function
fp(x1,x2) = (f(x1) - f(x2))/(x1 - x2)
x2, x1 = x2 - f(x2)/fp(x1, x2), x2 # update step</code></pre>
<p>We can repeat via copy and paste:</p>
<pre class="{julia}"><code>x2, x1 = x2 - f(x2)/fp(x1, x2), x2
x2, x1 = x2 - f(x2)/fp(x1, x2), x2
x2, x1 = x2 - f(x2)/fp(x1, x2), x2
x2, x1 = x2 - f(x2)/fp(x1, x2), x2
x2, x1 = x2 - f(x2)/fp(x1, x2), x2

x2, f(x2)</code></pre>
<p>The last line shows the algorithm has basically converged, as the values agree to <span class="math inline">\(10^{-14}\)</span>. We have</p>
</section>
<section id="using-forward-differences" class="level3" data-number="8.4.2">
<h3 data-number="8.4.2" class="anchored" data-anchor-id="using-forward-differences"><span class="header-section-number">8.4.2</span> Using forward differences</h3>
<p>Recall the forward difference approximation to the derivative:</p>
<p><span class="math display">\[
f'(x) \approx \frac{f(x + h) - f(x)}{h}
\]</span></p>
<p>For some small <span class="math inline">\(h\)</span> (with <span class="math inline">\(h=10^{-8}\)</span> a reasonable choice for many functions). This can be used</p>
<p>One can also use approximate derivatives based on forward differences in place of <span class="math inline">\(f'(x)\)</span> in the formula. Again, this won’t be as fast.</p>
<p>The update step <span class="math inline">\(x - f(x)/f'(x)\)</span> becomes</p>
<p><span class="math display">\[
x - \frac{h \cdot f(x)}{f(x+h) - f(x)}.
\]</span></p>
<p>The issue with this approximation is when the estimated value gets close to the actual root, the value of <span class="math inline">\(h\)</span> becomes too large. Steffenson’s method replaces <span class="math inline">\(h\)</span> with <span class="math inline">\(f(x)\)</span>, which for values close to a root gets quite small. This improves the convergence rate to be on par with Newton’s method. In this case, the update step looks like</p>
<p><span class="math display">\[
x - \frac{f(x)^2}{f(x+ f(x)) - f(x)}.
\]</span></p>
</section>
<section id="problems" class="level3" data-number="8.4.3">
<h3 data-number="8.4.3" class="anchored" data-anchor-id="problems"><span class="header-section-number">8.4.3</span> Problems</h3>
<section id="question-6" class="level4">
<h4 class="anchored" data-anchor-id="question-6">Question</h4>
<p>Use the secant method to find a root to <span class="math inline">\(f(x) = \cos(x) - x^3\)</span> starting with <span class="math inline">\(x_0=1/2\)</span> and <span class="math inline">\(x_1=1\)</span>.</p>
<pre class="{julia}"><code>#| echo: false
using Roots
f(x) = cos(x) - x^3
x1, x0 = 1, 1/2
x = find_zero(f, (x0, x1), Roots.Secant())
numericq(x, 1e-10)</code></pre>
</section>
<section id="question-7" class="level4">
<h4 class="anchored" data-anchor-id="question-7">Question</h4>
<p>Use the secant method to find a root to <span class="math inline">\(f(x) = x^5 + x - 1\)</span> starting with <span class="math inline">\(x_0=1/2\)</span> and <span class="math inline">\(x_1=1\)</span>.</p>
<pre class="{julia}"><code>#| echo: false
f(x) = x^5 + x - 1
x1, x0 = 1, 1/2
x = find_zero(f, (x0, x1), Roots.Secant())
numericq(x, 1e-10)</code></pre>
</section>
</section>
</section>
<section id="the-find_zero-function" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="the-find_zero-function"><span class="header-section-number">8.5</span> The <code>find_zero</code> function</h2>
<p>There are also very fast algorithms which do not require a derivative. The <code>Roots</code> package provides an interface to these through the <code>find_zero</code> function.</p>
<p>The <code>find_zero</code> function has two interfaces:</p>
<ul>
<li>when called with a bracketing interval, as in <code>find_zero(f, (a,b))</code>, it will use a bisection method to find a root.</li>
<li>when called with a starting point, as in <code>find_zero(f, a)</code>, it will use an iterative algorithm to search for a root.</li>
</ul>
<p>Many bracketing methods (like bisection) are guaranteed to converge, but can be slow. The iterative algorithm used by default with <code>find_zero</code> tries to speed the convergence up, but if along the way it finds a bracketing interval, that will guarantee convergence.</p>
<p>We focus on the simplest usage of <code>find_zero</code> where an initial guess is supplied and the default order is used. Here is an example to find <span class="math inline">\(-\sqrt{2}\)</span>:</p>
<pre class="{julia}"><code>f(x) = x^2 - 2
find_zero(f, -1)</code></pre>
<section id="using-find_zero-and-a-graph-to-find-all-roots." class="level3" data-number="8.5.1">
<h3 data-number="8.5.1" class="anchored" data-anchor-id="using-find_zero-and-a-graph-to-find-all-roots."><span class="header-section-number">8.5.1</span> Using <code>find_zero</code> and a graph to find all roots.</h3>
<p>Let’s look, again, at the task of finding all zeros to the function <span class="math inline">\(e^x - x^4\)</span>. We follow a standard approach:</p>
<ul>
<li>graph the function to roughly identify potential zeros</li>
<li>use these as starting points for <code>find_zero</code> to improve</li>
</ul>
<p>The following graph suggests, perhaps, there may be <span class="math inline">\(3\)</span> zeros, one near <span class="math inline">\(9\)</span>, one near <span class="math inline">\(2\)</span> and one near <span class="math inline">\(-1\)</span>.</p>
<pre class="{julia}"><code>f(x) = exp(x) - x^4
plot(f, -5,9)</code></pre>
<p>We can improve these guesses with</p>
<pre class="{julia}"><code>find_zero(f, 9), find_zero(f, 2), find_zero(f, -1)</code></pre>
<p>The above can be written without repeating <code>find_zero</code> by using a comprehension:</p>
<pre class="{julia}"><code>[find_zero(f, x) for x in [9, 2, -1]]</code></pre>
<p>Or even more compactly, using the broadcast notation:</p>
<pre class="{julia}"><code>find_zero.(f, [-1, 2, 9])</code></pre>
<hr>
<p>As another illustration, let <span class="math inline">\(f(x) = \cos^2(x^2)\)</span> on <span class="math inline">\([-1,2]\)</span>. Find all the zeros of the derivative of <span class="math inline">\(f(x)\)</span>.</p>
<p>We graph the derivative to identify starting points:</p>
<pre class="{julia}"><code>f(x) = cos(x^2)^2
plot(f', -1, 2)</code></pre>
<p>We see there are 3 potential zeros, one near 0, one near 1.2 and close to 1.7. Here we improve our guesses:</p>
<pre class="{julia}"><code>xs = find_zero.(f', [0, 1.2, 1.7])   # or [find_zero(f', x) for x in [0, 1.2, 1.7]]</code></pre>
<p>The function values at these points can be found with</p>
<pre class="{julia}"><code>f.(xs)               # or map(f, xs) or [f(x) for x in xs]</code></pre>
<section id="find_zeros" class="level5">
<h5 class="anchored" data-anchor-id="find_zeros">find_zeros</h5>
<p>For such tasks, <code>find_zeros</code> also works well. This function looks for all zeros in the interval <code>[a,b]</code>:</p>
<pre class="{julia}"><code>find_zeros(f, -1, 2)</code></pre>
</section>
</section>
<section id="practice-2" class="level3" data-number="8.5.2">
<h3 data-number="8.5.2" class="anchored" data-anchor-id="practice-2"><span class="header-section-number">8.5.2</span> Practice</h3>
<section id="question-8" class="level4">
<h4 class="anchored" data-anchor-id="question-8">Question</h4>
<p>Let</p>
<p><span class="math display">\[
f(x) = 4x^4 -5x^3 + 4x^2 -20x - 6
\]</span></p>
<p>Apply Newton’s method with <span class="math inline">\(x_0=0\)</span> using an automatic derivative. What value does it converge to?</p>
<pre class="{julia}"><code>#| echo: false
f(x) = 4x^4 -5x^3 + 4x^2 -20x - 6
val = newton(f, 0);
numericq(val, 1e-10)</code></pre>
</section>
<section id="question-9" class="level4">
<h4 class="anchored" data-anchor-id="question-9">Question</h4>
<p>Let’s try with a function where the derivative is not known easily. If we set</p>
<p><span class="math display">\[
f(x) = x^x - 2
\]</span></p>
<p>Can we find a root using Newton’s method, where <span class="math inline">\(x &gt; 0\)</span>?</p>
<p>We graph the function to see, using a smallish interval at first:</p>
<pre class="{julia}"><code>f(x) = x^x - 2
plot(f, 0, 2)
plot!(zero)</code></pre>
<p>Eyeing this, we pick an initial point, <span class="math inline">\(1\)</span>, for Newton’s method (<code>newton(f, 1)</code>) to the right of the minimum, which appears to be around <span class="math inline">\(x=0.35\)</span>.</p>
<p>What is the value of the approximate zero?</p>
<pre class="{julia}"><code>#| echo: false
xstar = newton(f, 1)
numericq(xstar, 1e-8)</code></pre>
</section>
<section id="question-10" class="level4">
<h4 class="anchored" data-anchor-id="question-10">Question</h4>
<p>Use <code>find_zero</code> to find the one root of <code>x^5 - x - 1</code>. First plot to get an estimate.</p>
<pre class="{julia}"><code>#| echo: false
f(x) = x^5 - x - 1
xstar = find_zero(f, 1)
numericq(xstar, 1e-8)</code></pre>
</section>
<section id="question-11" class="level4">
<h4 class="anchored" data-anchor-id="question-11">Question</h4>
<p>Let <span class="math inline">\(f(x) = 5/\sin(x) + 8/\cos(x)\)</span>, Starting at <span class="math inline">\(x=\pi/4\)</span>, use <code>find_zero</code> to find a root of the derivative of <span class="math inline">\(f(x)\)</span> given by <code>f'</code>.</p>
<pre class="{julia}"><code>#| echo: false
f(x) = 5/sin(x) + 8/cos(x)
xstar = find_zero(f', pi/4)
numericq(xstar, 1e-8)</code></pre>
</section>
<section id="question-12" class="level4">
<h4 class="anchored" data-anchor-id="question-12">Question</h4>
<p>The tangent line of <code>f</code> at <code>c</code> can be computed by</p>
<pre class="{julia}"><code>tangent(f, c) = x -&gt; f(c) + f'(c) * (x - c)</code></pre>
<p>Let <span class="math inline">\(f(x) = x^2 - 3x + 5\)</span>. Use <code>find_zero</code> to find the intersection point of the tangent line at <span class="math inline">\(1\)</span> and the tangent line at <span class="math inline">\(3\)</span>. Where does this happen?</p>
<p>(Hint, apply <code>find_zero</code> to <code>h(x) = tangent(f, 1)(x) -  tangent(f, 3)(x)</code> starting at 1.)</p>
<pre class="{julia}"><code>#| echo: false
tangent(f, c) = x -&gt; f(c) + f'(c) * (x - c)
f(x) = x^2 - 3x + 5
h1(x) = tangent(f, 1)(x) - tangent(f, 3)(x)
xstar = find_zero(h1, 1)
numericq(xstar, 1e-8)</code></pre>
</section>
</section>
</section>
<section id="various-issues-with-newtons-method" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="various-issues-with-newtons-method"><span class="header-section-number">8.6</span> Various issues with Newton’s method</h2>
<p>As great as Newton’s method is, it won’t always work for various reasons, some of which are described in the following. Here is what you need to keep in mind. Newton’s method works well if</p>
<ul>
<li>The zero is a simple root – that is of multiplicity 1</li>
<li>The magnitude, <span class="math inline">\(|f'(x)|\)</span>, is not too small (If the tangent line is nearly flat, the next guess is far from the previous)</li>
<li>The magnitude, <span class="math inline">\(|f''(x)|\)</span>, is not too big (function doesn’t have so much curve that the tangent line is a poor approximation)</li>
<li>The initial guess is not to far from a zero</li>
</ul>
<p>The above points come from the following formula which you can find in many texts.</p>
<p><span class="math display">\[
\Delta x_{i+1} = \frac{f' '(\alpha)}{f'(\alpha)}(\Delta x_i)^2 + \text{error}
\]</span></p>
<p>which is valid when <span class="math inline">\(f(x)\)</span> satisfies <span class="math inline">\(f(\alpha) = 0\)</span>, the third derivative exists near <span class="math inline">\(\alpha\)</span>, and <span class="math inline">\(\Delta x_i = x_i - \alpha\)</span> is the error between the zero and the <span class="math inline">\(i\)</span> th estimate. When the derivative at <span class="math inline">\(\alpha\)</span> is non-zero, the error is basically a constant times <span class="math inline">\(\Delta x_i^2\)</span>. This is interpreted as saying there is quadratic convergence in the error, as the next one is related to the previous one squared.</p>
<p>Now we look at some cases where the above three points do not hold.</p>
<section id="the-initial-guess-is-no-where-near-the-end-results" class="level3" data-number="8.6.1">
<h3 data-number="8.6.1" class="anchored" data-anchor-id="the-initial-guess-is-no-where-near-the-end-results"><span class="header-section-number">8.6.1</span> The initial guess is no where near the end results</h3>
<p>Let <span class="math inline">\(f(x) = \sin(x) - x/4\)</span> and <span class="math inline">\(x_0 = 2\pi\)</span>. This value is deliberately a poor choice:</p>
<pre class="{julia}"><code>f(x) = sin(x) - x/4
fp(x) = cos(x) - 1/4
newton(f, fp, 2pi, verbose=true)</code></pre>
<p>Though <code>julia</code> makes this happen fast, it will take more than 20 steps before converging and the answer is no where near the guess. This trace might show why</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/newton/newton-way-off.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Newton, way off</figcaption><p></p>
</figure>
</div>
<section id="question-13" class="level4">
<h4 class="anchored" data-anchor-id="question-13">Question</h4>
<p>When <span class="math inline">\(|f'(x)|\)</span> is too close to <span class="math inline">\(0\)</span>, the path can jump alot. In the figure, what was the longest jump?</p>
<pre class="{julia}"><code>#| echo: false
choices = ["From about 17 to -10",
     "From about -12 to -3",
     "From about 0 to -5"
     ];
answer = 1;
radioq(choices, answer)</code></pre>
</section>
<section id="question-14" class="level4">
<h4 class="anchored" data-anchor-id="question-14">Question</h4>
<p>The method did find a zero, but the initial guess was nowhere near the final zero. How close was the closest zero to the initial guess?</p>
<pre class="{julia}"><code>#| echo: false
choices = ["`8.75`", "`2pi`", "`3.8`"];
answer = 3;
radioq(choices, answer)</code></pre>
</section>
</section>
<section id="function-has-a-poor-shape" class="level3" data-number="8.6.2">
<h3 data-number="8.6.2" class="anchored" data-anchor-id="function-has-a-poor-shape"><span class="header-section-number">8.6.2</span> Function has a poor shape</h3>
<p>Let <span class="math inline">\(f(x) = x^{1/3}\)</span>. We know the root is 0. Let’s see what happens if we use Newton’s method. We have to be careful though as <code>julia</code> thinks that cube roots of negative numbers (via <code>x^(1/3)</code> are <code>NaN</code>, not a number. (You can avoid this, by making your number complex, e.g.&nbsp;<code>x + 0*im</code>, but then the real answer is not given as an answer. It is just one of three and not the chosen one.)</p>
<p>So we define our function using <code>julia</code>’s <code>cbrt</code> function, which works as we desire for negative numbers, as follows:</p>
<pre class="{julia}"><code>f(x) = cbrt(x)
xstar = newton(f, 2)</code></pre>
<p>Still an issue. Why?</p>
<section id="question-15" class="level4">
<h4 class="anchored" data-anchor-id="question-15">Question</h4>
<p>Despite all our care with the derivative, the method did not converge in <span class="math inline">\(200\)</span> steps. Can you see why from this trace?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/newton/newton-cubic.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Newton, cubic</figcaption><p></p>
</figure>
</div>
<pre class="{julia}"><code>#| echo: false
choices = [
    "`|f'(x)|` gets too small",
    "`|f''(x)|` gets too big at 0",
    "Initial guess is too far from a zero."
];
answer = 2;
radioq(choices, answer, keep_order=true)</code></pre>
</section>
<section id="question-solve-by-hand" class="level4">
<h4 class="anchored" data-anchor-id="question-solve-by-hand">Question: solve by hand</h4>
<p>For <span class="math inline">\(f(x) = x^{1/3}\)</span>, simplify the expression by hand:</p>
<pre class="math"><code>x - f(x)/f'(x)</code></pre>
<p>What do you get?</p>
<pre class="{julia}"><code>#| echo: false
choices =[
    "`x - (1/3)x^{-1/3}`",
    "`-2x`",
    "`x - 3/x`"
];
answer = 2;
radioq(choices, answer)</code></pre>
</section>
<section id="question-16" class="level4">
<h4 class="anchored" data-anchor-id="question-16">Question</h4>
<p>Apply Newton’s method to <span class="math inline">\(f(x) = (x-2)^7 \cdot (x-3) \cdot (x-4)\)</span> starting at 1.9981. The algorithm does not converge to 2 – an obvious root. From a plot of <span class="math inline">\(f(x)\)</span> explain why not:</p>
<pre class="{julia}"><code>#| echo: false
choices = [
    "`|f'(x)|` gets too small",
    "`|f''(x)|` gets too big at 0",
    "Initial guess is to far from a zero."
];
answer = 1;
radioq(choices, answer, keep_order=true)</code></pre>
</section>
<section id="question-17" class="level4">
<h4 class="anchored" data-anchor-id="question-17">Question</h4>
<p>The function <code>f(x) = atan(x)</code> is a strictly increasing function with one zero, <span class="math inline">\(0\)</span>. Yet it can pose problems with Newton’s method. For which values of <span class="math inline">\(x\)</span> does Newton’s method converge:</p>
<pre class="{julia}"><code>#| echo: false
choices = [
    L"For each of $1$, $2$ and $\pi$",
    L"For $1$ and $2$ but not $\pi$",
    L"For $1$ but not $2$ or $\pi$",
    L"For none of  $1$, $2$ and $\pi$" ]
answer = 3
radioq(choices, answer, keep_order=true)</code></pre>
</section>
</section>
<section id="cycles" class="level3" data-number="8.6.3">
<h3 data-number="8.6.3" class="anchored" data-anchor-id="cycles"><span class="header-section-number">8.6.3</span> Cycles</h3>
<p>Sometimes, the process can cycle even for reasonable functions.</p>
<section id="question-18" class="level4">
<h4 class="anchored" data-anchor-id="question-18">Question</h4>
<p>Let <span class="math inline">\(f(x) = x^3 - 5x\)</span>. Starting with <span class="math inline">\(x_0=1\)</span>, compute three steps of Newton’s method. What are the terms in the series produced?</p>
<pre class="{julia}"><code>#| echo: false
choices = [
    L"1, -2, -4,  ...",
    L"-1.0, 1.0, -1.0, ...",
    L"-1.0, 0.6666666666666667, -0.2850952524822228, ..."
];
answer = 2;
radioq(choices, answer)</code></pre>
</section>
<section id="question-always-cycles" class="level4">
<h4 class="anchored" data-anchor-id="question-always-cycles">Question: always cycles…</h4>
<p>Here is a pathological example where the value always cycles no matter where you start unless you start at <span class="math inline">\(0\)</span>.</p>
<p>Let <span class="math inline">\(f(x) = \sqrt{|x|}\)</span>. This is the one-sided square root function turned into an even function. We could also have defined it by:</p>
<pre class="{julia}"><code>f(x) = x &gt;= 0 ? sqrt(x) : sqrt(-x)</code></pre>
<p>where the ternary operator <code>a ? b : c</code> looks at <code>a</code> and if true will execute <code>b</code> otherwise <code>c</code>.</p>
<p>This makes it easier to write the derivative of the function in <code>Julia</code>:</p>
<pre class="{julia}"><code>fp(x) = x &gt;=0 ? (1/2)*sqrt(x)/x : -(1/2)*sqrt(-x)/(-x)</code></pre>
<p>To see what happens when using Newton’s method, lets start at <span class="math inline">\(x=2\)</span></p>
<pre class="{julia}"><code>x = 2
x = x - f(x)/fp(x)
x = x - f(x)/fp(x)
x = x - f(x)/fp(x)</code></pre>
<p>Try again with <span class="math inline">\(x=3.0\)</span> What sequence do you get:</p>
<pre class="{julia}"><code>#| echo: false
choices =
    [L"3, -3.0, 3.0, -3.0, ...",
     L"2, -2.0, 2.0, -2.0",
     L"3, 2.0, 1.0, 0.0, -1.0, ..."
     ];
answer = 1;
radioq(choices, answer)</code></pre>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./first-second-derivatives.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Exploring first and second derivatives with Julia</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./extrema.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Maximization and minimization with Julia</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>